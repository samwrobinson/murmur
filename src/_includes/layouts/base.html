<!-- A fully fleshed-out <head>, dynamically changing based on client.json and the page front matter -->

<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Standard meta tags -->
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="{{ description }}">
        <link rel="canonical" href="{{ client.domain }}{{ page.url }}">
        <meta name="generator" content="{{ eleventy.generator }}">

        <!--Social Media Display-->
        <meta property="og:title" content="{{ title }}"/>
        <meta property="og:description" content="{{ description }}"/>
        <meta property="og:type" content="website"/>
        <meta property="og:url" content="{{ client.domain }}{{ page.url }}"/>
        <meta property="og:image" content="{{ image or "/assets/images/logo-small.png" }}"/>
        <meta property="og:image:secure_url" content="{{ image or "/assets/images/logo-small.png" }}"/>

        <!--Favicons-->
        <!-- https://realfavicongenerator.net/ -->
        <link rel="icon" type="image/png" href="/assets/favicons/favicon-96x96.png" sizes="96x96"/>
        <link rel="icon" type="image/svg+xml" href="/assets/favicons/favicon.svg"/>
        <link rel="shortcut icon" href="/assets/favicons/favicon.ico"/>
        <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png"/>
        <meta name="apple-mobile-web-app-title" content="Murmur"/>
        <link rel="manifest" href="/assets/favicons/site.webmanifest"/>

        <!-- Preloads -->
        <link rel="preload" as="image" href="/assets/images/logo-icon.png">
        <link rel="preload" as="font" type="font/woff2" href="/assets/fonts/fraunces-v38-latin-regular.woff2" crossorigin>
        <link rel="preload" as="font" type="font/woff2" href="/assets/fonts/crimson-pro-v28-latin-regular.woff2" crossorigin>

        <!-- Sitewide Stylesheets and Scripts -->
        <link rel="stylesheet" href="/assets/css/root.css">
        <script>
            window.MURMUR_API = "{{ client.apiUrl }}" || "";
            if (window.MURMUR_API.includes("localhost")) {
                window.MURMUR_API = window.MURMUR_API.replace("localhost", location.hostname);
            }
            // Capacitor fix: its file server doesn't resolve directory URLs to index.html
            if (window.location.protocol === "capacitor:") {
                document.addEventListener("click", function(e) {
                    var link = e.target.closest("a[href]");
                    if (!link) return;
                    var href = link.getAttribute("href");
                    if (!href || !href.startsWith("/")) return;
                    // Split off query string and hash
                    var parts = href.split("?");
                    var path = parts[0];
                    var query = parts.length > 1 ? "?" + parts.slice(1).join("?") : "";
                    // Only rewrite directory-style paths (no file extension)
                    if (path.indexOf(".") === -1) {
                        e.preventDefault();
                        path = path.endsWith("/") ? path + "index.html" : path + "/index.html";
                        window.location.href = path + query;
                    }
                });
            }
        </script>
        <script defer src="/assets/js/nav.js"></script>

        {% block head %}{% endblock %}

        <title>{{ title }}</title>
    </head>
    <body>
        <!--Screen reader skip main nav-->
        <a class="skip" aria-label="skip to main content" href="#main">Click To Skip To Main Content</a>

        {% include "sections/header.html" %}
        <main id="main">
            <!-- Capacitor first-run: prompt to set Pi address -->
            <div id="cap-setup-banner" style="display:none; background: var(--primary); color: #fff; padding: 1rem; text-align: center; border-radius: 0.5rem; margin: 5rem 1rem 1rem;">
                <p style="margin: 0 0 0.75rem; font-weight: 600;">Connect to your Pi</p>
                <input id="cap-pi-url" type="url" placeholder="http://murmur.local" style="width: 100%; padding: 0.5rem; border-radius: 0.25rem; border: none; font-size: 1rem; box-sizing: border-box;">
                <button onclick="
                    var url = document.getElementById('cap-pi-url').value.trim().replace(/\/+$/, '');
                    if (url) {
                        localStorage.setItem('murmur_pi_url', url);
                        this.textContent = 'Saved! Reloading...';
                        setTimeout(function(){ location.reload(); }, 500);
                    }
                " style="margin-top: 0.5rem; padding: 0.5rem 1.5rem; border: 2px solid #fff; background: transparent; color: #fff; border-radius: 0.25rem; font-size: 1rem; cursor: pointer; width: 100%;">Save & Connect</button>
            </div>
            {% block body %}{% endblock %}
        </main>
        {% include "sections/footer.html" %}

    </body>
</html>